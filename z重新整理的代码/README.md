# EMG-IMU å¤šæ¨¡æ€æ‰‹åŠ¿è¯†åˆ«

åŸºäºEMGï¼ˆè‚Œç”µä¿¡å·ï¼‰å’ŒIMUï¼ˆæƒ¯æ€§æµ‹é‡å•å…ƒï¼‰çš„å¤šæ¨¡æ€æ‰‹åŠ¿è¯†åˆ«é¡¹ç›®ã€‚

## ğŸ“Œ é¡¹ç›®ç»“æ„

```
zé‡æ–°æ•´ç†çš„ä»£ç /
â”œâ”€â”€ config.py          # é…ç½®æ–‡ä»¶ï¼ˆEMGå’ŒIMUçš„æ¨¡å‹é…ç½®ï¼‰
â”œâ”€â”€ model.py           # æ¨¡å‹å®šä¹‰ï¼ˆä¸‰è·¯å¹¶è¡Œç½‘ç»œæ¶æ„ï¼‰
â”œâ”€â”€ data_loader.py     # æ•°æ®åŠ è½½æ¨¡å—
â”œâ”€â”€ trainer.py         # è®­ç»ƒæ¨¡å—ï¼ˆåˆ†ç¦»å¼è®­ç»ƒç­–ç•¥ï¼‰
â”œâ”€â”€ train.py           # ä¸»è®­ç»ƒè„šæœ¬ï¼ˆè®­ç»ƒå…¥å£ï¼‰
â”œâ”€â”€ test.py            # æµ‹è¯•/æ¨ç†è„šæœ¬
â””â”€â”€ README.md          # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

### ä¸‰è·¯å¹¶è¡Œæ¶æ„

```
è¾“å…¥:
  â”œâ”€ EMG: [batch, 400, 12, 1]   # 12é€šé“è‚Œç”µä¿¡å·
  â””â”€ IMU: [batch, 400, 36, 1]   # 36é€šé“IMUä¿¡å·ï¼ˆ12ä¼ æ„Ÿå™¨Ã—3è½´ï¼‰

ç¼–ç å™¨:
  â”œâ”€ EMGç¼–ç å™¨ â†’ [batch, 64, 12, 1]
  â”œâ”€ IMUç¼–ç å™¨ â†’ [batch, 64, 36, 1]
  â””â”€ èåˆç¼–ç å™¨ â†’ [batch, 64, 72, 1]

åˆ†ç±»å™¨:
  â”œâ”€ EMGåˆ†ç±»å™¨ â†’ [batch, 50]
  â”œâ”€ IMUåˆ†ç±»å™¨ â†’ [batch, 50]
  â””â”€ èåˆåˆ†ç±»å™¨ â†’ [batch, 50]

è¾“å‡º:
  â””â”€ ä¸‰è·¯åŠ æƒæ±‚å’Œ â†’ [batch, 50] â†’ 50ç±»æ‰‹åŠ¿åˆ†ç±»
```

### ç¼–ç å™¨å†…éƒ¨ç»“æ„

æ¯ä¸ªç¼–ç å™¨åŒ…å«ï¼š
1. **æ—¶åºå±‚1**ï¼ˆTemporal_layerï¼‰ï¼šGLUé—¨æ§æœºåˆ¶ + BatchNorm
2. **ç©ºé—´å±‚1**ï¼ˆSpatial_layerï¼‰ï¼šSEBlockæ³¨æ„åŠ› + è‡ªé€‚åº”GNNï¼ˆåˆ‡æ¯”é›ªå¤«K=1 + å¤šå¤´æ³¨æ„åŠ›ï¼‰
3. **æ—¶åºå±‚2**ï¼ˆTemporal_layerï¼‰ï¼š+ BatchNorm

### æ ¸å¿ƒç‰¹æ€§

- âœ… **è‡ªé€‚åº”é‚»æ¥çŸ©é˜µ**ï¼šé€šè¿‡å¤šå¤´æ³¨æ„åŠ›å­¦ä¹ ä¼ æ„Ÿå™¨é—´å…³ç³»
- âœ… **åˆ†ç¦»å¼è®­ç»ƒ**ï¼šä¸‰ä¸ªæ¨¡å—ç‹¬ç«‹ä¼˜åŒ–ï¼Œé¿å…æ¨¡æ€é—´å¹²æ‰°
- âœ… **detachæœºåˆ¶**ï¼šèåˆåˆ†æ”¯ä¸å½±å“encoderè®­ç»ƒ
- âœ… **æ—¶ç©ºè§£è€¦**ï¼šTemporalå±‚å’ŒSpatialå±‚äº¤æ›¿æå–ç‰¹å¾

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install torch numpy
```

### 2. å‡†å¤‡æ•°æ®

æ•°æ®æ ¼å¼ä¸º`.pt`æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- `train_examples_datasets`: è®­ç»ƒé›†EMGæ•°æ®
- `train_acc_datasets`: è®­ç»ƒé›†IMUæ•°æ®
- `train_labels_datasets`: è®­ç»ƒé›†æ ‡ç­¾
- `test_examples_datasets`: éªŒè¯é›†EMGæ•°æ®
- `test_acc_datasets`: éªŒè¯é›†IMUæ•°æ®
- `test_labels_datasets`: éªŒè¯é›†æ ‡ç­¾
- `class_counts`: å„ç±»åˆ«æ ·æœ¬æ•°é‡

### 3. è®­ç»ƒæ¨¡å‹

```bash
# åŸºç¡€è®­ç»ƒ
python train.py --subject 24 --gpu 0

# è‡ªå®šä¹‰å‚æ•°
python train.py \
    --subject 24 \
    --data_path /path/to/DB2_s{subject}allseg40020mZsc_rest.pt \
    --batch_size 64 \
    --num_epochs 500 \
    --gpu 0 \
    --save_dir ./weights
```

### 4. æµ‹è¯•æ¨¡å‹

```bash
python test.py \
    --subject 24 \
    --model_path ./weights/subject24_best.pt \
    --gpu 0
```

## âš™ï¸ è®­ç»ƒé…ç½®

### æ ¸å¿ƒè¶…å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| batch_size | 64 | æ‰¹æ¬¡å¤§å° |
| num_epochs | 500 | æœ€å¤§è®­ç»ƒè½®æ•° |
| learning_rate | 0.01 | å­¦ä¹ ç‡ï¼ˆSGDä¼˜åŒ–å™¨ï¼‰ |
| patience | 15 | æ—©åœåˆå§‹è€å¿ƒå€¼ |
| patience_increase | 10 | æ‰¾åˆ°æ›´å¥½æ¨¡å‹æ—¶å¢åŠ çš„è€å¿ƒå€¼ |

### ä¼˜åŒ–ç­–ç•¥

- **ä¼˜åŒ–å™¨**ï¼šSGDï¼ˆæ‰€æœ‰ä¼˜åŒ–å™¨lr=0.01ï¼‰
- **æŸå¤±å‡½æ•°**ï¼šCrossEntropyLoss
- **å­¦ä¹ ç‡è°ƒåº¦**ï¼šReduceLROnPlateauï¼ˆç›‘æ§éªŒè¯å‡†ç¡®ç‡ï¼Œfactor=0.2ï¼Œpatience=15ï¼‰
- **æ—©åœç­–ç•¥**ï¼šéªŒè¯å‡†ç¡®ç‡ä¸å†æå‡æ—¶åœæ­¢è®­ç»ƒ

### åˆ†ç¦»å¼è®­ç»ƒ

ä½¿ç”¨ä¸‰ä¸ªç‹¬ç«‹ä¼˜åŒ–å™¨ï¼š
```python
optimizer_imu = SGD(imu_encoder + imu_classifier, lr=0.01)
optimizer_emg = SGD(emg_encoder + emg_classifier, lr=0.01)
optimizer_fusion = SGD(fusion_encoder + fusion_classifier, lr=0.01)
```

åå‘ä¼ æ’­é¡ºåºï¼š
```python
imu_loss.backward(retain_graph=True)
optimizer_imu.step()

emg_loss.backward(retain_graph=True)
optimizer_emg.step()

fusion_loss.backward()
optimizer_fusion.step()
```

## ğŸ“Š å®éªŒç»“æœ

å—è¯•è€…24çš„è®­ç»ƒæ—¥å¿—ç¤ºä¾‹ï¼š
```
è®­ç»ƒé›†å¤§å°: EMG (8000, 400, 12, 1), IMU (8000, 400, 36, 1)
éªŒè¯é›†å¤§å°: EMG (4000, 400, 12, 1), IMU (4000, 400, 36, 1)
æ¨¡å‹å‚æ•°æ€»æ•°: ~X,XXX,XXX
è®­ç»ƒå®Œæˆï¼Œè€—æ—¶ XXåˆ† XXç§’
æœ€ä½³éªŒè¯å‡†ç¡®ç‡: XX.XX%
```

## ğŸ” ä»£ç è¯´æ˜

### config.py
å®šä¹‰EMGå’ŒIMUä¸¤ç§æ¨¡æ€çš„é…ç½®å‚æ•°ã€‚

### model.py
åŒ…å«æ‰€æœ‰æ¨¡å‹ç»„ä»¶ï¼š
- åŸºç¡€å±‚ï¼šChebConv, GNN, Temporal_layer, SEBlock, Spatial_layer
- ç¼–ç å™¨ï¼šEncoder
- èåˆæ¨¡å—ï¼šCrossAttentionFusion, FusionEncoder
- åˆ†ç±»å™¨ï¼šClassifier
- å®Œæ•´æ¨¡å‹ï¼šMultimodalGestureNet

### trainer.py
è®­ç»ƒæ ¸å¿ƒé€»è¾‘ï¼Œå®ç°åˆ†ç¦»å¼è®­ç»ƒç­–ç•¥ã€‚

### train.py
è®­ç»ƒå…¥å£è„šæœ¬ï¼Œå¤„ç†å‚æ•°è§£æå’Œè®­ç»ƒæµç¨‹ã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®è·¯å¾„**ï¼šè¯·ä¿®æ”¹`train.py`ä¸­çš„`--data_path`å‚æ•°æŒ‡å‘ä½ çš„æ•°æ®æ–‡ä»¶
2. **GPUè®¾ç½®**ï¼šä½¿ç”¨`--gpu`å‚æ•°æŒ‡å®šGPUç¼–å·
3. **éšæœºç§å­**ï¼šé»˜è®¤seed=0ï¼Œå¯é€šè¿‡`--seed`ä¿®æ”¹ä»¥å¤ç°å®éªŒ

## ğŸ“„ å¼•ç”¨

å¦‚æœä½¿ç”¨æœ¬ä»£ç ï¼Œè¯·å¼•ç”¨ç›¸å…³è®ºæ–‡ã€‚

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜è¯·è”ç³»ï¼š[your-email@example.com]

